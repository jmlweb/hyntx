name: Test NPM Token

on:
  workflow_dispatch:

jobs:
  test-token:
    name: Test NPM Token
    runs-on: ubuntu-latest

    steps:
      - name: Test NPM_TOKEN is set
        run: |
          if [ -z "${{ secrets.NPM_TOKEN }}" ]; then
            echo "❌ NPM_TOKEN secret is NOT set"
            exit 1
          else
            echo "✅ NPM_TOKEN secret is set"
            echo "Token length: ${#NPM_TOKEN}"
          fi
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

      - name: Test npm whoami with token
        run: |
          echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > ~/.npmrc
          echo "Testing npm whoami..."
          if npm whoami; then
            echo "✅ NPM authentication successful!"
            echo "Logged in as: $(npm whoami)"
          else
            echo "❌ NPM authentication failed"
            exit 1
          fi
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

      - name: Test npm access
        run: |
          echo "Testing npm access to hyntx package..."
          if npm access list packages 2>&1 | grep -q "hyntx"; then
            echo "✅ Has access to hyntx package"
          else
            echo "⚠️  Package access check (may fail if not owner)"
          fi
